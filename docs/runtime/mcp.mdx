---
title: "MCP Servers"
description: "Deploy MCP servers as HTTP endpoints with Ray Serve"
---

Use `rayai.serve_mcp()` to deploy [MCP (Model Context Protocol)](https://modelcontextprotocol.io/) servers as scalable HTTP endpoints via Ray Serve.

## Quick Start

Create a new MCP server:

```bash
rayai create-mcp weather
```

This creates `mcp_servers/weather/server.py`:

```python
from mcp.server.fastmcp import FastMCP
import rayai

mcp = FastMCP("weather", stateless_http=True)


@mcp.tool()
async def example_tool(query: str) -> str:
    """Example tool - replace with your own.

    Args:
        query: Input query to process
    """
    return f"Processed: {query}"


rayai.serve_mcp(mcp, name="weather")
```

Run the server:

```bash
rayai up
```

Your MCP server is now available at `http://localhost:8000/weather/mcp`.

## Adding Tools

Define tools using FastMCP's `@mcp.tool()` decorator:

```python
from mcp.server.fastmcp import FastMCP
import rayai

mcp = FastMCP("myserver", stateless_http=True)


@mcp.tool()
async def search(query: str) -> str:
    """Search for information.

    Args:
        query: Search query
    """
    return f"Results for: {query}"


@mcp.tool()
async def add_numbers(a: int, b: int) -> int:
    """Add two numbers together.

    Args:
        a: First number
        b: Second number
    """
    return a + b


rayai.serve_mcp(mcp, name="myserver")
```

## Using MCP Servers with Agents

Here's an example using Pydantic AI:

```python
from pydantic_ai import Agent
from pydantic_ai.mcp import MCPServerStreamableHTTP
import rayai

weather_server = MCPServerStreamableHTTP("http://localhost:8000/weather/mcp")

def make_agent():
    return Agent(
        "openai:gpt-4o-mini",
        system_prompt="You are a helpful assistant.",
        toolsets=[weather_server],
    )

rayai.serve(make_agent, name="my_agent")
```

When you run `rayai up`, both the MCP server and agent start on the same port. The agent can then use tools from the MCP server.

## serve_mcp Options

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `mcp_server` | FastMCP | required | FastMCP instance (must use `stateless_http=True`) |
| `name` | str | None | Server name (inferred from directory if not set) |
| `num_cpus` | float | 1 | CPU cores per replica |
| `num_gpus` | float | 0 | GPUs per replica |
| `memory` | str | "512MB" | Memory per replica |
| `replicas` | int | 1 | Number of replicas |
| `route_prefix` | str | /\{name\} | URL prefix (endpoint: /\{name\}/mcp) |
